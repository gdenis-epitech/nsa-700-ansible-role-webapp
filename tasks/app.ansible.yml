- name: "Copy app to server"
  ansible.builtin.copy:
    src: files/app/
    dest: /app/
    directory_mode:
    owner: ansible
    group: ansible
    mode: "0755"

- name: "Ensure node && npm in $PATH"
  ansible.builtin.shell: >
    source /home/ansible/.nvm/nvm.sh
  args:
    executable: /bin/bash
  register: out
  changed_when: out.rc != 0
  become: true
  become_user: ansible

- name: "Install app packages"
  community.general.npm:
    path: /app
    executable: /home/ansible/.nvm/versions/node/v10.13.0/bin/npm
  become: true
  become_user: ansible
